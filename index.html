<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google</title>
    <!-- Tailwind CSS CDN for modern and responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* استفاده از فونت استاندارد براي شبيه‌سازي ظاهر گوگل */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Vazirmatn', 'Roboto', sans-serif;
            background-color: #ffffff;
            color: #202124;
        }

        /* استايل براي نوار پيمايش بالا که حالت جستجو يا اخبار را نشان مي‌دهد */
        .tab-button {
            /* تنظيمات اصلي: پدينگ، مکان‌نما، اندازه فونت، خط زيرين شفاف، رنگ متن پيش‌فرض خاکستري */
            @apply p-3 cursor-pointer text-sm font-medium border-b-4 border-transparent text-gray-500 transition-colors duration-150;
        }

        /* حالت هاور براي تمام دکمه‌ها: نمايش خط خاکستري ملايم */
        .tab-button:hover {
            /* اين خط زيرين ملايم فقط هنگام هاور ظاهر مي‌شود */
            border-bottom-color: #e0e0e0; 
        }
        
        /* حالت فعال: نمايش خط آبي/نيلي پررنگ و تغيير رنگ متن (اولويت بالاتر با !important) */
        .tab-active {
            /* هنگام فعال بودن، خط آبي پررنگ و رنگ متن آبي پررنگ مي‌شود */
            @apply text-indigo-700 border-indigo-700 !important;
        }

        /* استايل براي محل مخفي نمايش رمز */
        .hidden-result {
            color: #dadce0; 
            font-size: 0.7rem;
            direction: ltr;
        }

        /* انيميشن محو شدن براي نتيجه رمزگشايي - 0.5 ثانيه */
        .fade-out {
            opacity: 0;
            transition: opacity 0.5s ease-out; 
        }
        
        #decrypted-text {
            direction: rtl; 
            font-family: 'Vazirmatn', sans-serif; 
        }
        
        /* حذف خط پيش‌فرض خاکستري از زير هدر که باعث ايجاد خط ناخواسته مي‌شد */
        .main-header {
            @apply w-full border-b-0; /* خط زيرين هدر اصلي را پاک مي‌کنيم */
        }
        
        /* خط خاکستري ملايم فقط به پايين نوار ناوبري (nav) اضافه مي‌شود تا تب‌ها را از محتواي زيرين جدا کند */
        .nav-bar {
            @apply border-b border-gray-200;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center">

    <!-- Header & Navigation Bar (Simulating Google Search UI) -->
    <header class="main-header w-full">
        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
            <!-- Google Logo (Placeholder) -->
            <div class="text-2xl font-semibold text-gray-800">
                <span class="text-blue-500">G</span><span class="text-red-500">o</span><span class="text-yellow-500">o</span><span class="text-blue-500">g</span><span class="text-green-500">l</span><span class="text-red-500">e</span>
            </div>
            
            <!-- User Info -->
            <div id="user-info-display" class="hidden-result md:inline-block"></div>
        </div>
        
        <!-- Search Tabs (Key for switching modes) -->
        <nav class="nav-bar max-w-6xl mx-auto px-4">
            <div class="flex space-x-6 space-x-reverse">
                <button id="search-tab" class="tab-button tab-active">جستجو</button>
                <button id="news-tab" class="tab-button">اخبار</button>
                <button id="images-tab" class="tab-button">تصاوير</button>
                <button id="maps-tab" class="tab-button">نقشه‌ها</button>
            </div>
        </nav>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 w-full max-w-xl px-4 pt-10">
        <!-- Main Search Input -->
        <div class="relative mb-6">
            <input 
                id="search-input" 
                type="text" 
                placeholder="" 
                autocomplete="off" 
                class="w-full p-3 pl-10 border border-gray-300 rounded-full shadow-md focus:shadow-lg focus:border-indigo-500 outline-none text-base"
                autofocus
            >
            <!-- Search Icon -->
            <svg class="w-5 h-5 absolute top-3 left-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
        </div>

        <!-- Mode Status & Decrypted Result Area (Now completely empty) -->
        <div id="mode-status" class="text-center mb-6 text-lg font-semibold text-gray-600">
            <!-- اين قسمت هميشه خالي است تا هيچ متني ظاهر نشود -->
        </div>

        <!-- Decryption Result Display (Hidden initially, appears on News mode success/failure) -->
        <!-- کادر بدون هيچ استايل هشداري، فقط يک ديو پنهان است -->
        <div id="decryption-box" class="hidden p-3 text-center" role="alert">
            <!-- اين پاراگراف براي عنوان بود که حالا خالي مي‌ماند -->
            <p class="font-bold mb-2"></p>
            <!-- متن رمزگشايي شده با اندازه و رنگ عادي -->
            <p id="decrypted-text" class="text-base text-gray-800"></p>
        </div>

        <!-- Dynamic Search Results Area -->
        <div id="results-area" class="mt-8">
            <!-- Results will be dynamically inserted here -->
        </div>
    </main>

    <!-- Footer (Cleaned up, no hidden output here) -->
    <footer class="w-full mt-auto py-3 border-t border-gray-200 text-center">
        <p class="text-gray-500 text-xs">
            © 2025 Google - <a href="#" class="underline">حريم خصوصي</a> - <a href="#" class="underline">شرايط</a>
        </p>
    </footer>


    <!-- Firebase SDKs & Core Logic -->
    <script type="module">
        // --- واردات ماژول‌هاي فايربيس ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- متغيرهاي گلوبال فايربيس ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;
        let userId = null;
        let isAuthReady = false;
        let currentMode = 'encode'; 
        
        // --- عناصر DOM ---
        const searchInput = document.getElementById('search-input');
        const searchTab = document.getElementById('search-tab');
        const newsTab = document.getElementById('news-tab');
        const imagesTab = document.getElementById('images-tab');
        const mapsTab = document.getElementById('maps-tab');
        const modeStatus = document.getElementById('mode-status');
        const decryptionBox = document.getElementById('decryption-box');
        const decryptedText = document.getElementById('decrypted-text');
        const userInfoDisplay = document.getElementById('user-info-display');
        const resultsArea = document.getElementById('results-area');
        
        // --- پيکربندي و کليد رمز ---
        const SECRET_KEY = "GEMINI-CODE-25"; 
        const START_ASCII = 32; 
        const END_ASCII = 126;  
        const RANGE = END_ASCII - START_ASCII + 1;
        
        // --- تنظيمات کليد نامرئي (Stealth Mode) ---
        const INVISIBLE_CHARS = ['\u200B', '\u200C', '\u200D', '\u2060']; 
        const BASE_N = INVISIBLE_CHARS.length; // 4
        const BASE_36 = '0123456789abcdefghijklmnopqrstuvwxyz'; 
        const STEALTH_TRIGGER_KEY = '\u200B\u200C\u200D\u2060'; 

        // --- توابع رمزگذاري و رمزگشايي Vigenere-like ---

        function base64Encode(str) {
            const utf8Str = unescape(encodeURIComponent(str));
            return btoa(utf8Str);
        }

        function base64Decode(str) {
            try {
                const utf8Str = atob(str);
                return decodeURIComponent(escape(utf8Str));
            } catch (e) {
                return "خطا در رمزگشايي Base64. (Error: Invalid Cipher Format)";
            }
        }

        function getKeyShift(key, index) {
            return (key.charCodeAt(index % key.length) - START_ASCII);
        }

        function encrypt(plaintext) {
            const base64Str = base64Encode(plaintext);
            let ciphertext = "";
            for (let i = 0; i < base64Str.length; i++) {
                let charCode = base64Str.charCodeAt(i);
                if (charCode >= START_ASCII && charCode <= END_ASCII) { 
                    let keyShift = getKeyShift(SECRET_KEY, i);
                    let shiftedCode = charCode - START_ASCII;
                    let newShiftedCode = (shiftedCode + keyShift) % RANGE;
                    ciphertext += String.fromCharCode(newShiftedCode + START_ASCII);
                } else {
                    ciphertext += base64Str[i]; 
                }
            }
            return ciphertext;
        }

        function decrypt(ciphertext) {
            let base64Str = "";
            for (let i = 0; i < ciphertext.length; i++) {
                let charCode = ciphertext.charCodeAt(i);
                if (charCode >= START_ASCII && charCode <= END_ASCII) {
                    let keyShift = getKeyShift(SECRET_KEY, i);
                    let shiftedCode = charCode - START_ASCII;
                    let newShiftedCode = (shiftedCode - keyShift + RANGE) % RANGE;
                    base64Str += String.fromCharCode(newShiftedCode + START_ASCII);
                } else {
                    base64Str += ciphertext[i];
                }
            }
            return base64Decode(base64Str);
        }
        
        // --- توابع Stealth Mode ---

        function generateShortId() {
            // توليد يک UUID کوتاه 16 کاراکتري
            return Date.now().toString(36) + Math.random().toString(36).substring(2, 6) + crypto.randomUUID().substring(0, 4);
        }

        function encodeCharToStealth(char36) {
            const index36 = BASE_36.indexOf(char36);
            if (index36 === -1) return ''; 

            const c1 = Math.floor(index36 / 16); 
            const remaining = index36 % 16;
            const c2 = Math.floor(remaining / 4); 
            const c3 = remaining % 4; 
            
            return INVISIBLE_CHARS[c1] + INVISIBLE_CHARS[c2] + INVISIBLE_CHARS[c3];
        }

        function encodeIdToStealthKey(shortId) {
            let stealthKey = STEALTH_TRIGGER_KEY; 
            for (const char of shortId) {
                stealthKey += encodeCharToStealth(char);
            }
            return stealthKey;
        }

        function decodeStealthKeyToId(stealthText) {
            if (!stealthText.startsWith(STEALTH_TRIGGER_KEY)) return null;
            let encodedBody = stealthText.substring(STEALTH_TRIGGER_KEY.length);
            
            let shortId = '';
            
            for (let i = 0; i < encodedBody.length; i += 3) {
                if (i + 2 >= encodedBody.length) break; 

                const char1 = encodedBody[i];
                const char2 = encodedBody[i+1];
                const char3 = encodedBody[i+2];

                const c1Index = INVISIBLE_CHARS.indexOf(char1);
                const c2Index = INVISIBLE_CHARS.indexOf(char2);
                const c3Index = INVISIBLE_CHARS.indexOf(char3);
                
                if (c1Index === -1 || c2Index === -1 || c3Index === -1) break;

                const index36 = (c1Index * 16) + (c2Index * 4) + c3Index;
                
                if (index36 >= BASE_36.length) break; 
                
                shortId += BASE_36.charAt(index36);
            }
            return shortId.length > 0 ? shortId : null;
        }

        // --- توابع Firestore ---
        
        function getCipherDocRef(cipherId) {
             const path = `artifacts/${appId}/public/data/ciphers`;
             return doc(db, path, cipherId);
        }

        async function saveCipherToFirebase(cipherText) {
            const cipherId = generateShortId(); 
            const cipherDocRef = getCipherDocRef(cipherId);
            
            await setDoc(cipherDocRef, {
                cipher: cipherText,
                createdAt: Date.now(),
            });
            
            return cipherId;
        }

        async function getCipherFromFirebase(cipherId) {
            const cipherDocRef = getCipherDocRef(cipherId);
            const docSnap = await getDoc(cipherDocRef);
            
            if (docSnap.exists()) {
                return docSnap.data().cipher;
            } else {
                return null;
            }
        }

        // --- راه‌اندازي فايربيس ---
        async function setupFirebase() {
            try {
                setLogLevel('Debug');
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        userInfoDisplay.textContent = `User: ${userId.substring(0, 8)}...`;
                        isAuthReady = true;
                    } else {
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    }
                });

            } catch (error) {
                console.error("خطا در راه‌اندازي فايربيس (Auth/DB):", error);
                // تنها پيام خطاي سيستمي در اينجا مجاز است.
                displayError("خطا در اتصال به سرويس. لطفاً مرورگر را رفرش کنيد.");
            }
        }
        
        // --- منطق تغيير حالت (Mode Switching) ---

        function switchMode(mode) {
            currentMode = mode;
            
            // پاکسازي حالت فعال از همه تب‌ها
            searchTab.classList.remove('tab-active');
            newsTab.classList.remove('tab-active');
            imagesTab.classList.remove('tab-active');
            mapsTab.classList.remove('tab-active');
            
            searchInput.value = '';
            resultsArea.innerHTML = '';
            decryptionBox.classList.add('hidden');
            modeStatus.innerHTML = ''; // اطمينان از خالي بودن وضعيت

            // تنظيم حالت فعال بر اساس کليک
            let activeTabElement;
            const placeholderText = ""; 
            const statusHTML = ""; 
            let inputDirection = 'rtl';
            
            if (mode === 'encode') {
                activeTabElement = searchTab;
                inputDirection = 'rtl';
                
            } else if (mode === 'decode') {
                activeTabElement = newsTab;
                inputDirection = 'ltr'; 
                
            } else if (mode === 'images') {
                activeTabElement = imagesTab;
                inputDirection = 'rtl';
                
            } else if (mode === 'maps') {
                activeTabElement = mapsTab;
                inputDirection = 'rtl';
            }
            
            if (activeTabElement) {
                activeTabElement.classList.add('tab-active');
            }

            // اعمال تغييرات به DOM
            searchInput.placeholder = placeholderText; 
            modeStatus.innerHTML = statusHTML; 
            searchInput.style.direction = inputDirection;
            
            searchInput.focus();
        }

        // --- منطق مشترک براي پردازش ورودي ---
        function handleInput(e) {
            decryptionBox.classList.add('hidden');
            resultsArea.innerHTML = ''; // پاکسازي نتايج قبلي
            modeStatus.innerHTML = ''; // حذف هرگونه پيام وضعيت
            
            const query = searchInput.value;

            // 1. منطق رمزگذاري (فقط با Enter در حالت Encode)
            if (currentMode === 'encode' && e.type === 'keydown' && e.key === 'Enter') {
                e.preventDefault(); 
                const queryTrimmed = query.trim();
                if (!queryTrimmed) return; 

                searchInput.value = ''; 
                
                // نمايش فقط لودر (Spinner) براي شبيه‌سازي جستجو
                resultsArea.innerHTML = `
                    <div class="text-center mt-10">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                    </div>
                `;

                encryptAndSave(queryTrimmed);
            
            // 2. منطق رمزگشايي (بلافاصله با Input در حالت Decode)
            } else if (currentMode === 'decode' && e.type === 'input') {
                
                clearTimeout(window.decodeTimer); 

                if (query.length === 0) {
                    return;
                }
                
                window.decodeTimer = setTimeout(() => {
                    decryptAndFetch(query);
                }, 250); 
            }
            
            // 3. اگر حالت تصاوير يا نقشه‌ها فعال باشد، هيچ کاري انجام نمي‌دهيم تا طبيعي به نظر برسد.
        }
        
        // --- توابع اصلي پردازش ---

        async function encryptAndSave(plaintext) {
            if (!isAuthReady || !db) {
                displayError("خطا: احراز هويت يا پايگاه داده آماده نيست.");
                return;
            }

            try {
                const cipherText = encrypt(plaintext);
                const cipherId = await saveCipherToFirebase(cipherText);
                
                // نمايش خطاي جعلي مرورگر در ناحيه نتايج
                showFakeBrowserError(cipherId);

            } catch (error) {
                console.error("خطا در رمزگذاري و ذخيره:", error);
                displayError("خطا در ذخيره‌سازي رمز در پايگاه داده.");
            }
        }

        async function decryptAndFetch(stealthKeyInput) {
            if (!isAuthReady || !db) {
                displayError("خطا: احراز هويت يا پايگاه داده آماده نيست.");
                return;
            }
            
            const cipherId = decodeStealthKeyToId(stealthKeyInput);

            if (!cipherId) {
                resultsArea.innerHTML = '';
                // در صورت خطا، پيام خطاي نامحسوس را در کادر نمايش مي‌دهيم.
                displayDecryptedResult("خطا در بارگذاري محتوا. ممکن است اتصال ضعيف باشد.", true);
                return;
            }

            // لودر را در ناحيه نتايج نمايش مي‌دهيم (کاملاً شبيه به جستجوي واقعي)
            resultsArea.innerHTML = `
                <div class="text-center mt-10">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto mb-4"></div>
                    <p class="text-gray-500">در حال بازيابي اطلاعات... (ID: ${cipherId})...</p>
                </div>
            `;
            
            try {
                const cipherText = await getCipherFromFirebase(cipherId);

                if (cipherText) {
                    const decryptedTextResult = decrypt(cipherText);
                    searchInput.value = ''; 
                    // در صورت موفقيت، فقط کادر را نمايش مي‌دهيم.
                    displayDecryptedResult(decryptedTextResult, false); 
                } else {
                    // پيام خطاي نامحسوس در صورت عدم وجود کليد در ديتابيس
                    displayDecryptedResult(`خطا در بازيابي اطلاعات. سرور در دسترس نيست.`, true);
                }
            } catch (error) {
                 console.error("خطا در بازيابي و رمزگشايي:", error);
                 displayDecryptedResult("خطاي غيرمنتظره در ارتباط با پايگاه داده.", true);
            }
        }
        
        // --- توابع کمکي DOM ---

        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.top = '0';
            textarea.style.left = '0';
            textarea.style.width = '1px';
            textarea.style.height = '1px';
            textarea.style.opacity = '0'; 
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.setSelectionRange(0, textarea.value.length); 
            let success = false;
            try {
                success = document.execCommand('copy');
            } catch (err) {
                console.error('Failed to copy text', err);
            }
            document.body.removeChild(textarea);
            return success;
        }

        function displayError(message) {
            resultsArea.innerHTML = `
                <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg shadow-lg" role="alert">
                    <p class="font-bold mb-1">خطا:</p>
                    <p>${message}</p>
                </div>
            `;
        }
        
        // --- توابع جديد براي خطاي جعلي مرورگر در صفحه ---

        function showFakeBrowserError(cipherId) {
            const stealthKey = encodeIdToStealthKey(cipherId);
            const errorId = crypto.randomUUID().substring(0, 12);

            resultsArea.innerHTML = `
                <div class="flex items-start bg-white p-6 border border-gray-300 rounded-lg shadow-xl text-left rtl:text-right" style="direction: ltr;">
                    <!-- Icon -->
                    <svg class="w-8 h-8 text-red-500 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                    </svg>
                    
                    <!-- Content -->
                    <div class="ml-4 text-gray-800 flex-grow">
                        <h3 class="text-xl font-bold mb-1" style="font-family: 'Roboto', sans-serif;">ERR_CACHE_WRITE_FAILURE</h3>
                        <p class="text-sm mb-3">
                            The search engine could not process the request due to an unhandled security exception (Error Code: <span class="font-mono text-xs">${errorId}</span>). 
                            This may be a temporary issue with browser storage or content policies.
                        </p>
                        
                        <!-- Retry Button (The Copy Mechanism) -->
                        <button id="retry-copy-btn" 
                                class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-md font-medium hover:bg-blue-700 transition-colors shadow-md text-sm">
                            Retry
                        </button>
                        
                        <p id="copy-status-message" class="text-xs mt-3 h-4 text-gray-600">
                            <!-- Status message appears here -->
                        </p>
                    </div>
                </div>
            `;
            
            // افزودن شنونده به دکمه Retry جديد
            const retryButton = document.getElementById('retry-copy-btn');
            const statusMessage = document.getElementById('copy-status-message');
            const originalButtonText = retryButton.textContent; // "Retry"

            retryButton.addEventListener('click', () => {
                if (copyToClipboard(stealthKey)) {
                    // --- تغييرات جديد: حذف پيام متني و فقط تغيير بصري ---
                    statusMessage.innerHTML = ''; // پيام وضعيت را خالي نگه مي‌داريم
                    retryButton.classList.remove('bg-blue-600', 'bg-red-600');
                    retryButton.classList.add('bg-green-600');
                    // *** خطي که متن دکمه را به 'Copied' تغيير مي‌داد حذف شد. ***

                    // پاک کردن پيام پس از 3 ثانيه براي بازگشت به حالت اوليه
                    setTimeout(() => {
                        resultsArea.innerHTML = '';
                        // اطمينان از بازگشت دکمه به رنگ آبي اصلي (گرچه با حذف resultsArea ديگر مهم نيست)
                        // اما براي تميزي کد:
                        retryButton.classList.remove('bg-green-600');
                        retryButton.classList.add('bg-blue-600'); 
                        retryButton.textContent = originalButtonText;

                        searchInput.focus();
                    }, 3000);
                    
                } else {
                    // در صورت خطاي کپي، پيام خطا را نمايش مي‌دهيم.
                    statusMessage.innerHTML = '<span class="text-red-600 font-bold">Error:</span> Manual copy failed. Please try reloading.';
                    retryButton.classList.remove('bg-blue-600');
                    retryButton.classList.add('bg-red-600');
                    retryButton.textContent = originalButtonText; // اطمينان از حفظ متن اصلي
                }
            });
        }

        function displayDecryptedResult(textResult, isError) {
            
            decryptedText.textContent = textResult;
            decryptionBox.classList.remove('hidden');
            decryptionBox.classList.remove('fade-out'); 
            
            const titleElement = decryptionBox.querySelector('p.font-bold');

            // در حالت موفقيت (Success)
            if (!isError) {
                // متن رمزگشايي شده با رنگ عادي (خاکستري تيره) نمايش داده مي‌شود
                decryptedText.classList.remove('text-red-500'); 
                decryptedText.classList.add('text-gray-800');
                titleElement.textContent = "";

            // در حالت خطا (Error)
            } else {
                 // پيام خطاي نامحسوس
                 decryptedText.classList.remove('text-gray-800');
                 decryptedText.classList.add('text-red-500'); // براي نشان دادن خطا
                 titleElement.textContent = "";
            }

            // منطق 4 ثانيه‌اي: 3.5 ثانيه نمايش + 0.5 ثانيه محو شدن
            setTimeout(() => { 
                // 1. شروع محو شدن
                decryptionBox.classList.add('fade-out'); 
                
                // 2. پنهان کردن کامل بعد از اتمام انيميشن محو شدن (0.5 ثانيه)
                setTimeout(() => {
                    decryptionBox.classList.add('hidden');
                    decryptionBox.classList.remove('fade-out');
                    modeStatus.innerHTML = ''; 
                    searchInput.focus(); 
                }, 500); // 500ms = مدت زمان انيميشن در CSS

            }, 3500); // 3500ms = مدت زمان نمايش قبل از شروع محو شدن
        }

        // --- مديريت رويدادها ---

        searchTab.addEventListener('click', () => switchMode('encode'));
        newsTab.addEventListener('click', () => switchMode('decode'));
        imagesTab.addEventListener('click', () => switchMode('images'));
        mapsTab.addEventListener('click', () => switchMode('maps'));

        searchInput.addEventListener('keydown', handleInput); 
        searchInput.addEventListener('input', handleInput); 
        
        // --- مقداردهي اوليه ---
        setupFirebase();
        switchMode('encode'); 

    </script>
</body>
</html>
